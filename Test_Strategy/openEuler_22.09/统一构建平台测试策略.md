![openEuler ico](../../images/openEuler.png)

版权所有 © 2022 openEuler社区  
您对“本文档”的复制、使用、修改及分发受知识共享(Creative Commons)署名—相同方式共享4.0国际公共许可协议(以下简称“CC BY-SA
4.0”)的约束。为了方便用户理解，您可以通过访问<https://creativecommons.org/licenses/by-sa/4.0/>了解CC BY-SA 4.0的概要 (但不是替代)。CC BY-SA
4.0的完整协议内容您可以访问如下网址获取：<https://creativecommons.org/licenses/by-sa/4.0/legalcode>。

修订记录

| 日期       | 修订版本 | 特性描述       | 修改描述               | 作者       |
| ---------- | -------- | ---------------- | ---------------------- | ---------- |
|2022/9/6  |   1.0  |       统一构建平台           | 初稿                   |zhangpanting　　　|



**Keywords 关键词**：

统一构建平台测试策略 web界面 命令行 单包构建 全量构建 增量构建 门禁构建

**摘要**：

按照测试要求，通过在命令行和web界面对统一构建平台的单包构建、全量构建、增量构建、门禁构建能力进行验证。

**缩略语清单**：

| 缩略语      | 英文全名 | 中文解释      |
| ---------- | -------- | ---------------- |
|PR| Pull Requests | 合入请求 |
|OBS| Open Build Service | 开放的构建平台 |

# 概述
　本测试策略为统一构建平台的测试策略，目的在于验证构建平台的可用性，可靠性，以及构建产物的正确性等。

## 版本背景
　统一构建平台是一个支持多种形式创建任务，简化多包构建，提升包构建效率，任务可追溯，支持重复构建，支持结果发布的一个构建系统。

# 测试分层策略

本次统一构建平台的具体测试分层策略如下：

| **需求**                        | **测试分层策略**                                             |
| ------------------------------- |---------------------------------------------------------|
|支持web界面 |重点验证web界面支持project管理和构建、支持用户登录、支持package单包构建、全量构建、增量构建|
|支持命令行接口|重点验证命令行支持project管理、project中指定package单包构建、全量构建、增量构建|
|支持服务器场景iso制作|重点验证project的全量和增量构建功能，对任务中软件包状态的维护功能，以及publish任务repo的功能|
|支持服务器场景门禁和单包构建|验证服务器场景支持单包构建和门禁构建的功能|


# 测试分析设计策略

## 新增feature测试设计策略

| *序号* | *Feature*                    | *重点*                                                       | *设计思路*                                                   |
| ------ | ---------------------------- | ------------------------------------------------- | ------------------------------------------------------------ |
| 1 |web 支持project管理&构建 | 在web页面上验证查看project总体列、添加project、查看project包列表、查看project当前构建结果、project 删除和锁定、project添加package、继承方式创建project、project 进行全量构建、查看project 所有构建任务、查看project某构建包列表、终止project下的构建任务、project 某构建任务的包进行重复构建、终止project特定包的构建任务、对project构建目标进行查看，添加，修改与删除 、project的设置的用户进行查看，增加，修改，去除(关注不同用户的权限范围是否合理)、project进行增量构建的功能|通过功能用例覆盖验证|
| 2 |web 支持用户登录 | 在web页面上验证用户注册、用户登录、用户退出、首页介绍的功能 |通过功能用例覆盖验证|
| 3 |web 支持package的单包构建| 在web页面上验证package 删除、package锁定、package进行单包构建、package进行指定build_target的单包构建、对package配置的内容进行查看，支持修改url，branch、查看package所有构建及结果、查看package的构建日志、下载package构建的rpm包的功能、验证构建出的软件包功能是否正常 |通过功能用例覆盖验证|
| 4 |命令行 支持project管理 |  在命令行验证支持对project进行全量构建、查看project的构建任务状态、查看所有的projects、查看所有的snapshots、支持查看project的所有构建任务、取消构建任务、获取构建结果、查看构建日志的功能|通过功能用例覆盖验证|
| 5 |命令行支持project中指定package单包构建 | 在命令行验证支持project修改，删除、build_single进行单包构建，build 状态获取、下载软件包、project创建的功能 |通过功能用例覆盖验证|
| 6 |命令行支持project的增量构建 |在命令行验证支持对project进行增量构建(只对发生变化的软件包及受变化影响的软件包进行构建)的功能 |通过功能用例覆盖验证|
| 7 |支持服务器场景iso制作 |验证对project支持全量和增量构建的功能，验证dag服务支持：响应build_dag,对project进行增量和全量构建、响应job变更，对build任务中软件包状态进行维护、根据软件包配置，生成基于任务的构建依赖关系、判断某个包是否待构建、待构建包是否满足构建条件、任务执行成功后，触发publish任务的repo、多个构建任务同时进行，互不干扰的功能|生成的构建依赖关系是否正确、判断某个包是否待构建以及待构建包是否满足构建条件，需要单元测试覆盖验证，其余通过功能用例覆盖验证|
| 8 |支持服务器场景单包构建 | 验证构建源管理服务:project创建、修改删除、snapshot创建、build_single执行、gitmirror拉取最新代码、build_single实现submit、rpmbuild脚本适配、newrepo是否可用、pulisher、API网关对project，build等消息进行路由的功能|通过功能用例覆盖验证|
| 9 |支持服务器场景门禁构建 |验证gitmirror服务，接收pr请求，拉取代码、autosubmit服务－触发PR构建任务、创建临时project、对project进行PR构建、对影响到的包都进行pr构建、查询构建结果、下载构建成功的二进制包的功能| 通过功能用例端到端进行验证，并且覆盖门禁系统的异常场景，如：同一pr在门禁构建过程中，多次强制构建|

## 专项测试策略

### 对外接口测试
检查接口的功能，接口返回的数据是否与预期一致，检查接口的容错性和健壮性，检查接口的性能以及安全性。

  
### 资料测试

| **资料名称**       | **覆盖策略**                                                           |
|------------------|------------------------------------------------------------------------|
|设计文档　|各模块描述是否清晰，正确，是否和平台行为一致|
|接口文档|是否包含接口概述（接口名称、接口功能、接口类别），请求参数说明（参数名、是否必选、类型、取值范围），返回说明（反回数据格式、返回结果示例、错误代码及返回说明）|

### 性能测试

| **测试项**       | **规格**            |
|----------------------|---------------------------|
|增量/全量构建任务启动时间        |<2min                   |
|单包构建任务启动时间        |<10s                      |
|镜像构建时长 |<30min(4000包)；<10min(500包)                      |
|构建任务并发数 |<10000 (单包构建任务);<10(全量构建任务，4000＋包的项目)   

| **常用场景接口**       | **TPS目标规格**            |　　**RT目标规格**|　**备注**|
|----------------------|---------------------------|---------------------------|---------------------------|
|web或cli接口响应        |50/s （1000在线用户,5%并行度,1000*5%=50）  |日志类:<=10s;下载类访问:<=10s | TP99 |

### 可靠性
    
| **测试项**       | **具体测试内容**                                                           |
|------------------|---------------------------------------------------------------------|
|长稳|系统在各种压力背景下，通过构造资源类和服务类异常，测试系统是否能够稳定运行，建议稳定性测试时长７*24　　|

### 韧性
   
| **故障对象**       | **测试场景(故障模式)**            |**FIT方法**     |**是否自动恢复**   |**故障检测时长**   |**故障恢复时长**   |**业务恢复率**   |**数据备份时长**   |
|------------------|------------------------|----------------|-----------------|--------------|-------------|------------|---------------|
|CPU |单节点CPU过载|cfe工具触发 |N|10s|<120s|100％　|不涉及|
|CPU |多节点CPU过载|cfe工具触发|N|10s|<120s|100％　|不涉及|
|内存|内存过载|cfe工具触发|N|10s|<600s|100％　|不涉及|
|硬盘|空间不足|cfe工具触发|N|10s|<600s|100％　|不涉及|
|网络|单节点入口带宽过载|cfe工具触发|N|10s|<600s|100％　|不涉及|
|整机|单节点服务器掉电|cfe工具触发|N|10s|<600s|100％　|不涉及|
|整机|单节点服务器重启|cfe工具触发|N|10s|<600s|100％　|不涉及|
|整机|多节点服务器掉电|cfe工具触发|N|10s|<600s|100％　|不涉及|
|整机|多节点服务器重启|cfe工具触发|N|10s|<600s|100％　|不涉及|
|服务|服务进程异常退出|cfe工具触发|Y|10s|<120s|100％　|不涉及|

### 二进制一致性验证

| **测试内容**       | **工具**            |**指标** 　　　　　|
|----------------------|---------------------------|---------------------------|
|对统一构建平台和OBS的构建交付件验证二进制一致性  |　BepCloud   |确保二进制一致性，存在的差异可解释(时间戳差异)|

### 安全测试

| **测试类**       | **具体测试项**                                                           |
|------------------|---------------------------------------------------------------------|
|安全功能测试　|隐私保护验证、安全敏感特性测试、威胁建模验证|
|已知安全问题或漏洞测试|端口扫描、主机漏洞扫描、数据库漏洞扫描、web漏洞扫描、开源软件漏洞扫描、安全编译选项检查、安全配置检查(os)、协议防攻击测试、安全配置检查、Docker漏洞扫描、协议fuzz测试、命令行fuzz测试、历史问题回归测试|
|未知安全问题或漏洞测试|代码质量度量、工具静态扫描、污点分析、高危模块＆代码接口检视、开源＆第三方软件使用合规、构建一致性评估、渗透测试|
|安全要求和规范满足度评估|高风险特性/模块质量评估、网络安全红线满足度评估、安全＆隐私保护规范满足度评估、客户需求＆安全准入满足度评估|
|安全风险评估|安全风险控制目标总体评估、疑似后门类问题评估、已知漏洞验证评估|


# 测试执行策略

## 测试计划

| Stange name   | Begin time | End time   | Note|
|------------- | ---------- | ----------  | --------|
|Test round 1|2022/9/15 | 2022/09/27|需求全量测试|
|Test round 2|2022/09/29|2022/10/10 |需求全量测试|
|Test round 3|2022/10/11 | 2022/10/15|问题单回归测试|

## 测试重点

1.  新特性的全量验证，重点关注重要模块的基本功能和完整性。

2.  多模块集成的正确性和完整性以及系统产物的正确性。

3.  专项测试满足测试指标。



