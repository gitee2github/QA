![openEuler ico](../../images/openEuler.png)

版权所有 © 2020  openEuler社区
 您对“本文档”的复制、使用、修改及分发受知识共享(Creative Commons)署名—相同方式共享4.0国际公共许可协议(以下简称“CC BY-SA 4.0”)的约束。为了方便用户理解，您可以通过访问https://creativecommons.org/licenses/by-sa/4.0/ 了解CC BY-SA 4.0的概要 (但不是替代)。CC BY-SA 4.0的完整协议内容您可以访问如下网址获取：https://creativecommons.org/licenses/by-sa/4.0/legalcode。

修订记录

| 日期     | 修订   版本 | 修改描述                       | 作者   |
| -------- | ----------- | ------------------------------ | ------ |
| 2021/3/9 | v1.0        | 添加stratovirt新增特性测试报告 | zhk128 |

 关键词： stratovirt 内存弹性(balloon) 内存大页 io增强 ioqos iothread 多平台支持 测试报告

 

摘要：依据测试要求，对stratovirt新增特性进行功能测试、可靠性测试、安全测试、性能测试。

 

缩略语清单：

| 缩略语 | 英文全名                           | 中文解释       |
| ------ | ---------------------------------- | -------------- |
| QoS    | Quality of Service                 | 服务质量       |
| IOPS   | Input/Output Operations Per Second | 每秒的读写次数 |

# 1     特性概述

1.Balloon即内存弹性，是位于guest中负责回收和释放内存的virtio设备，在虚拟机内存空闲时，可以向虚拟机借一部分内存给主机使用。

2.内存大页特性支持虚拟机使用主机上的静态大页。

3.磁盘Qos用来限制磁盘设备的iops。

4.iothread特性另起独立线程，解决多个设备IO处理函数、QMP处理函数共用主线程，从而导致设备的IO性能下降的问题。

5.stratovirt 支持在X86和Aarch64两个平台上使用。

# 2     特性测试信息

本节描述被测对象的版本信息和测试的时间及测试轮次，包括以来的硬件。

| 版本名称                           | 测试起始时间 | 测试结束时间 |
| ---------------------------------- | ------------ | ------------ |
| openEuler-21.03-RC-1(内存大页测试) | 2021/2/23    | 2021/3/12    |
| openEuler-21.03-RC-1(iothread测试) | 2021/2/24    | 2021/3/2     |
| openEuler-21.03-RC-1(内存弹性测试) | 2021/2/27    | 2021/2/28    |
| openEuler-21.03-RC-1(ioqos测试)    | 2021/3/1     | 2021/3/2     |

描述特性测试的硬件环境信息

| 硬件型号            | 硬件配置信息           | 备注        |
| ------------------- | ---------------------- | ----------- |
| 2288H V5(共四台)    | 32U256G 64U256G        | X86架构     |
| TaiShan 200(共四台) | 128U512G 64U256G 96U1T | aarch64架构 |

# 3     测试结论概述

## 3.1   测试整体结论

stratovirt新增特性，内存弹性共20个用例，ioqos共10个用例，iothread共24个用例，内存大页共61个用例，多平支持共2个用例。相关特性都覆盖了功能测试、可靠性测试、安全测试和性能测试。上述功能在一定的约束限制下都能发挥其特性能力。

## 3.2   约束说明

内存弹性约束：内核镜像需支持balloon特性，当前仅支持host，guest端页面大小相同的场景。

ioqos约束：限速范围[0, 1000000]，暂不支持热插，只能限制平均iops，无法限制突发流量。

iothread约束：总的io线程数量不超过8个，暂不支持热插。

内存大页：仅支持在stratovirt启动时在命令行中配置，仅支持静态大页，配置的内存规格不能大于配置的host大页总大小。

## 3.3   遗留问题分析

### 3.3.1 遗留问题影响以及规避措施

| 问题单号                                                     | 问题描述                                                     | 问题级别 | 问题影响和规避措施 | 当前状态 |
| ------------------------------------------------------------ | ------------------------------------------------------------ | -------- | ------------------ | -------- |
| https://gitee.com/openeuler/stratovirt/issues/I392KT?from=project-issue | 命令行启动虚拟机，-drive指定设备配置的iothread如果不存在，提示错误，但是返回值仍为0 | 一般     | 返回值错误         | 关闭     |
| https://gitee.com/openeuler/stratovirt/issues/I395AI?from=project-issue | config_guidebook.md中virtio-net设备热插提供的命令有误        | 一般     | 资料不完善         | 关闭     |
| https://gitee.com/openeuler/stratovirt/issues/I392HC?from=project-issue | 指定-daemonize参数启动虚拟机，同样的配置启动两次，第二次启动失败命令返回值仍为0 | 一般     | 资料不完善         | 关闭     |

### 3.3.2 问题统计

|        | 问题总数 | 严重 | 主要  | 次要  | 不重要 |
| ------ | -------- | ---- | ----- | ----- | ------ |
| 数目   | 6        | 0    | 1     | 5     | 0      |
| 百分比 | 100%     | 0    | 16.7% | 83.3% | 0      |

# 4     测试执行

## 4.1   测试执行统计数据

*本节内容根据测试用例及实际执行情况进行特性整体测试的统计，可根据第二章的测试轮次分开进行统计说明。*

| 版本名称                           | 测试用例数 | 用例执行结果 | 发现问题单数 |
| ---------------------------------- | ---------- | ------------ | ------------ |
| openEuler-21.03-RC-1(内存大页测试) | 61         | pass         | 0            |
| openEuler-21.03-RC-1(iothread测试) | 24         | pass         | 2            |
| openEuler-21.03-RC-1(内存弹性测试) | 20         | pass         | 0            |
| openEuler-21.03-RC-1(ioqos测试)    | 10         | pass         | 0            |

*数据项说明：*

*测试用例数－－到本测试活动结束时，所有可用测试用例数；*

*发现问题单数－－本测试活动总共发现的问题单数。*

## 4.2   后续测试建议



# 5     附件

*无*

 



 

 