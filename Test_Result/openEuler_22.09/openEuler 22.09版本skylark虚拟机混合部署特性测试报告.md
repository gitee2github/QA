![avatar](../../images/openEuler.png)


版权所有 © 2022  openEuler社区
 您对“本文档”的复制、使用、修改及分发受知识共享(Creative Commons)署名—相同方式共享4.0国际公共许可协议(以下简称“CC BY-SA 4.0”)的约束。为了方便用户理解，您可以通过访问https://creativecommons.org/licenses/by-sa/4.0/ 了解CC BY-SA 4.0的概要 (但不是替代)。CC BY-SA 4.0的完整协议内容您可以访问如下网址获取：https://creativecommons.org/licenses/by-sa/4.0/legalcode。

修订记录

| 日期          | 修订   版本 | 修改描述                          | 作者     |
| ------------- | ----------- | --------------------------------- | -------- |
| 2022年9月15日 | v1.0        | 新增skylark虚拟机混合部署测试报告 | @laputa0 |
| 2022年9月19日 | v1.1        | 修订部分描述                      | @laputa0 |

 关键词：skylark 虚拟机混合部署 资源隔离 QoS控制

摘要：本报告描述了混合部署工具skylark的使用场景及约束条件，总结了测试过程及问题解决情况。



缩略语清单：

| 缩略语 |           英文全名           |     中文解释      |
| :---- | :-------------------------- | :--------------- |
|  Qos   |      Quality of Service      |     服务质量      |
|  LLC   |       Last Level Cache       |   最后一级缓存    |
|  CPU   |   Central Processing Unit    |   中央处理单元    |
|  RDT   | Resource Director Technology | Intel资源调配技术 |

# 1     特性概述

云计算资源利用率低是行业普遍存在的问题，提升资源利用率已经成为了一个重要的技术课题。将业务区分优先级混合部署（简称混部）运行是典型有效的资源利用率提升手段。业务混部的核心技术是资源隔离控制。

Skylark是一种高低优先级虚拟机混部场景下的QoS感知的资源调度器，在保障高优先级虚拟机QoS前提下提升物理机资源利用率。截止测试时软件支持CPU时间片、SMT、内存带宽、LLC、功耗控制(x86)的干扰隔离与资源分配。

# 2     特性测试信息

本节描述被测对象的版本信息和测试的时间及测试轮次，包括依赖的硬件。

| 版本名称            | 测试起始时间 | 测试结束时间 |
| ------------------- | ------------ | ------------ |
| openEuler 22.09 RC2 | 2022/08/17   | 2022/08/29   |
| openEuler 22.09 RC3 | 2022/08/30   | 2022/09/06   |
| openEuler 22.09 RC4 | 2022/09/07   | 2022/09/16   |

描述特性测试的硬件环境信息

| 硬件型号        | 硬件配置信息                              | 备注             |
| --------------- | ----------------------------------------- | ---------------- |
| TaiShan 2280 V2 | Kunpeng-920                               | 需支持 MPAM 功能 |
| 2288H V6        | Intel(R) Xeon(R) Gold 6338N CPU @ 2.20GHz | 需支持 RDT 功能  |

# 3     测试结论概述

## 3.1   测试整体结论

针对本特性共设计19条测试用例，覆盖功能测试、特性交互测试、稳定性测试以及资料测试，发现5个问题，整体质量良好。

## 3.2   约束说明

1. 硬件约束： Intel x86，需包括RDT及PMU功能。ARM64，需包括MPAM及PMU功能。
2. 操作系统内核：需提供perf子系统支持，及cgroup、resctrl配置。
3. 应用层：需包含libvirt，并可拉起Qemu虚拟机。

## 3.3   遗留问题分析

### 3.3.1 遗留问题影响以及规避措施

| 问题单号 | 问题描述 | 问题级别 | 问题影响和规避措施 | 当前状态 |
| -------- | -------- | -------- | ------------------ | -------- |
|          |          |          |                    |          |

### 3.3.2 问题统计

|        | 问题总数 | 严重 | 主要 | 次要 | 不重要 |
| ------ | -------- | ---- | ---- | ---- | ------ |
| 数目   | 5        | 4    | 0    | 1    | 0      |
| 百分比 | 100%     | 80%  | 0%   | 20%  | 0%     |

# 4     测试执行

## 4.1   测试执行统计数据

*本节内容根据测试用例及实际执行情况进行特性整体测试的统计，可根据第二章的测试轮次分开进行统计说明。*

| 版本名称            | 测试用例数 | 用例执行结果   | 发现问题单数 |
| ------------------- | ---------- | -------------- | ------------ |
| openEuler 22.09 RC2 | 4          | 3 PASS,1 FAIL  | 1            |
| openEuler 22.09 RC3 | 13         | 10 PASS,3 FAIL | 3            |
| openEuler 22.09 RC4 | 19         | 18 PASS,1 FAIL | 1            |

*数据项说明：*

*测试用例数－－到本测试活动结束时，所有可用测试用例数；*

*发现问题单数－－本测试活动总共发现的问题单数。*

