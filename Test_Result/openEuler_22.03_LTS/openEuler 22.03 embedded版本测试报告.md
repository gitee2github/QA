![openEuler ico](../../images/openEuler.png)

版权所有 © 2022  openEuler社区
您对“本文档”的复制、使用、修改及分发受知识共享(Creative Commons)署名—相同方式共享4.0国际公共许可协议(以下简称“CC BY-SA 4.0”)的约束。为了方便用户理解，您可以通过访问[*https://creativecommons.org/licenses/by-sa/4.0/*](https://creativecommons.org/licenses/by-sa/4.0/) 了解CC BY-SA 4.0的概要 (但不是替代)。CC BY-SA 4.0的完整协议内容您可以访问如下网址获取：[*https://creativecommons.org/licenses/by-sa/4.0/legalcode*](https://creativecommons.org/licenses/by-sa/4.0/legalcode)。

修订记录

| 日期       | 修订版本 | 修改章节           | 修改描述   |
| ---------- | -------- | ------------------ | ---------- |
| 2022/03/21 | 1.0.0    | 初始               | saarloos |
| 2022/03/22 | 1.0.1    | 补充测试活动验证情况    | xukunkun |

关键词：

openEuler LTS  embedded  分布式软总线 混合部署 软实时 SDK

摘要：

文本主要描述openEuler 22.03-LTS embedded版本的整体测试过程，详细叙述测试覆盖情况，并通过问题分析对版本整体质量进行评估和总结。

缩略语清单：

| 缩略语      | 英文全名                             | 中文解释       |
| ----------- | ------------------------------------ | -------------- |
| OS          | Operating System                     | 操作系统       |
| LTS         | Long Time Support                    | 长时间维护     |
| CVE         | Common Vulnerabilities and Exposures | 通用漏洞批露   |
| QEMU        | quick emulator                       | 通用和开源的机器仿真器和虚拟器 |

---

\***

# 1   概述

openEuler Embedded是基于openEuler社区面向嵌入式场景的Linux版本，旨在成为一个高质量的以Linux为中心的嵌入式系统软件平台。

本文主要描述openEuler 22.03 embedded版本的总体测试活动，按照社区开发模式进行运作，结合社区release-manager团队制定的版本计划规划相应的测试计划及活动。测试报告覆盖新需求的测试执行情况和评估，并结合各类专项测试活动和版本问题单总体情况进行整体的说明和质量评估。

# 2   测试版本说明

openEuler embedded 22.03 版本是基于22年全新的LTS基线版本的Linux 5.10内核，根据嵌入式设备的特点进行实时能力增强和裁剪，主要功能：

1.  集成openEuler社区软实时补丁，提供软实时能力
2.  提供soc内实时和非实时多平面混合部署，支持硬实时能力
3.  引入鸿蒙分布式软总线，实现openEuler设备间的互联互通
4.  开放基于yocto构建镜像小型化裁剪能力及ARM交叉编译工具链支持
5.  支持树莓派4B作为嵌入式标准硬件

openEuler embedded 22.03 版本按照社区release-manager团队的计划，共规划6轮测试，详细的版本信息和测试时间如下表：

| 版本名称                    | 测试起始时间 | 测试结束时间 |
| --------------------------- | ------------ | ------------ |
| openEuler embedded 22.03 RC1 | 2022/3/3   | 2022/3/13   |
| openEuler embedded 22.03 RC2 | 2022/3/14  | 2022/3/18   |
| openEuler embedded 22.03 RC3 | 2022/3/19  | 2022/3/23   |
| openEuler embedded 22.03 RC4 | 2022/3/24  | 2022/3/28   |
| openEuler embedded 22.03 RC5 | 2022/3/29  | 2022/3/30   |
| openEuler embedded 22.03 RC6 | 2022/3/31  | 2022/4/1    |

测试的硬件环境如下：

| 硬件型号                            | 硬件配置信息                                                 | 备注                      |
| ----------------------------------- | ------------------------------------------------------------ | ------------------------- |
| 树莓派4B卡                     | CPU:BCM2711(Cortex-A72 * 4) <br />内存：4GB/8GB <br />存储设备：SanDisk Ultra 64GB micro SD |        |
| QEMU                          | CPU:Cortex-A15/A57 <br /> 最小启动内存：512M |        |


openEuler embedded 22.03版本交付需求列表如下：

| **no** | **feature**                                                  | **status** | **sig**                 | **owner**                                      |
| ------ | ------------------------------------------------------------ | ---------- | ----------------------- | ---------------------------------------------- |
| [I4YMW9](https://gitee.com/openeuler/yocto-meta-openeuler/issues/I4YMW9) | 集成openEuler社区软实时补丁 | Accepted | sig-yocto | @Wanming Hu |
| [I4YMUM](https://gitee.com/src-openeuler/OpenAMP/issues/I4YMUM) | 实现soc内实时和非实时多平面混合部署 | Accepted | sig-embedded | @Wayne Ren @wilson |
| [I4YMUX](https://gitee.com/openeuler/yocto-meta-openeuler/issues/I4YMUX) <br/> [I4Q7W7](https://gitee.com/openeuler/yocto-meta-openeuler/issues/I4Q7W7) | 开放基于Yocto构建包的小型化定制裁剪能力 | Accepted | sig-yocto | @ilisimin |
| [I4YMVX](https://gitee.com/src-openeuler/gcc-cross/issues/I4YMVX) | 基于社区10.3版本gcc提供ARM版本交叉编译工具链 | Accepted | sig-compiler | @wangding16 |
| [I4YMV8](https://gitee.com/openeuler/yocto-meta-openeuler/issues/I4YMV8) | 支持树莓派4B作为嵌入式通用硬件 | Accepted | sig-embedded | @liangfangping |
| [I4YMTP](https://gitee.com/openeuler/dsoftbus_standard/issues/I4YMTP) | 集成鸿蒙的分布式软总线，实现openEuler设备之间的互联互通 | Accepted | sig-yocto | @beilingxie @zheng liming |

本次openEuler 22.03 embedded版本测试活动分工如下：

| **需求**                     | **开发主体**      | **测试主体**      | **测试策略**                                                 |
| ---------------------------- | ----------------- | ----------------- | ------------------------------------------------------------ |
| 集成openEuler社区软实时补丁 | sig-yocto | sig-Yocto| 基于树莓派4b使用业界benchmark（cyclictest）验证空载条件下平均调度时延微秒级 |
| 实现soc内实时和非实时多平面混合部署 | sig-embedded | sig-embedded | openEuler Embedded对Zephyr的生命周期管理和基本通信 |
| 开放基于Yocto构建包的小型化定制裁剪能力 | sig-yocto | sig-yocto | 重点对yocto构建、裁剪以及相关资料进行验证，根据资料可构建出可自由配置裁剪软件包的基础文件系统|
| 基于社区10.3版本gcc提供ARM版本交叉编译工具链 | sig-compiler | sig-compiler | 针对交叉编译工具链的可用性进行验证 |
| 支持树莓派4B作为嵌入式通用硬件 | sig-yocto | sig-yocto | 通过构建指导能够生成在树莓派上部署使用的镜像 |
| 集成鸿蒙的分布式软总线，实现openEuler设备之间的互联互通 | sig-embedded | sig-embedded | 基于标准以太网的连接方式，实现QEMU之间的发现、连接、传输等API接口，支持设备间互通互联 |

# 3   版本概要测试结论

openEuler embedded 22.03版本整体测试按照release-manager团队的计划，共完成了一轮基础功能测试+一轮新特性测试+一轮专项测试+一轮用户使用场景测试+一轮回归测试；

其中一轮基础功能测试聚焦在linux系统调用、glibc和基础软件包功能的自动化验证，旨在识别阻塞性问题；一轮新特性测试开展对版本交付的所有特性的功能验证；另外一轮专项测试，涵盖安全、可靠性以及性能等dfx能力测试；用户使用场景测试模拟社区用户，按照使用指南中指导完成了镜像获取启动、基于SDK的应用开发以及容器构建环境的获取和一键构建；最后一轮回归测通过自动化测试重点覆盖问题单较多模块的覆盖和扩展测试，验证问题的修复和影响程度；

版本按照测试策略完成了全量功能验证和专项测试(性能、可靠性、兼容性、安全)，所有测试预计发布前按计划完成。本版本计划交付需求6个，实际交付6个，交付率100%，所有发布需求均验证通过。

​openEuler embedded 22.03版本共发现问题73个，修复问题71个，遗留问题2个(详见遗留问题章节)，其他问题均已修复，版本整体质量较好。

# 4   版本详细测试结论

22.03 版本详细测试内容包括：

1. 完成基础OS质量保障，包括内核、系统调用、glibc以及基础软件包的功能测试，测试功能正常，问题已跟踪闭环；
2. 对关键特性，如软实时能力、分布式软总线、yocto小型定制裁剪以及混合部署、ARM版本交叉编译工具链进行了专项特性测试，关键特性符合要求，测试功能正常，问题已跟踪闭环；
3. 其他专项测试包括安全专项、兼容性测试以及可靠性测试，完成各项专项测试，测试正常，问题已跟踪闭环；

## 4.1   特性测试结论

### 4.1.1   继承特性评价

对产品所有继承特性进行评价，用表格形式评价，包括特性列表（与特性清单保持一致），验证质量评估

| 序号 | 组件/特性名称                             |        特性质量评估        | 备注                                                                                                                   |
| ---- | ----------------------------------------- | :-------------------------: | ---------------------------------------------------------------------------------------------------------------------- |
| | | |

### 4.1.2   新需求评价

建议以表格的形式汇总新特性测试执行情况及遗留问题单情况的评估,给出特性质量评估结论。

| **序号** | **特性名称**                 | **测试覆盖情况**                                             | **约束依赖说明** | **遗留问题单** | **质量评估**               | **备注<img width=50/>**                                      |
| -------- | ---------------------------- | ------------------------------------------------------------ | ---------------- | -------------- | -------------------------- | ------------------------------------------------------------ |
| 1        | [集成openEuler社区软实时补丁](openEuler%2022.03%20embedded版本集成openEuler社区软实时补丁特性测试报告.md) |  在标准镜像的基础上集成软实时补丁，通过yocto构建出RT镜像，在树莓派4B上部署，使用开源benchmark工具cyclictest进行性能测试，测得空载状态下中断加调度的平均时延在微秒级别（8us） | NA | NA             | <font color=green>█</font>  |   集成RT补丁，提供工程构建指导 |
| 2        | [实现soc内实时和非实时多平面混合部署](openEuler%2022.03%20embedded版本实现soc内实时和非实时多平面混合部署特性测试报告.md) | 通过QEMU配置预留内存后启动openEuler Embedded镜像，启动后将依赖的内核模块、用户态程序、动态库以及zephyr镜像拷贝到QEMU，插入ko，运行程序拉起实时系统并完成之间的通信 | NA   | NA             | <font color=green>█</font>  | 功能演示基于QEMU环境 |
| 3        | 开放基于Yocto构建包的小型化定制裁剪能力 | 使用yocto的packagegroup类对openeuler的发布包按类型进行分组，在image和sdk中添加自定义的软件包 |  NA | NA             | <font color=green>█</font> |             |
| 4        | 基于社区10.3版本gcc提供ARM版本交叉编译工具链 | 由sig-compiler验证，同时在开发测试活动中已覆盖 | NA               | NA             | <font color=green>█</font> |                                                              |
| 5        | 支持树莓派4B作为嵌入式通用硬件 | 树莓派部署、基本OS质量已保证，用户可通过资料完成树莓派上镜像的构建、部署和基本使用 | NA | NA             | <font color=green>█</font> |  集成树莓派补丁，支持工程构建      |
| 6        | [集成鸿蒙的分布式软总线，实现openEuler设备之间的互联互通](openEuler%2022.03%20embedded版本集成鸿蒙的分布式软总线_实现openEuler设备之间的互联互通特性测试报告.md) | 在标准以太网的连接方式下，测试了QEMU之间的发现、连接和传输的API接口，验证了两台设备之间基于dsoftbus通信的互通互联 | NA | NA | <font color=blue>█</font> | 仅支持局域网下的coap发现，wifi/ble等功能在后续版本中持续支持 |

<font color=red>●</font>： 表示特性不稳定，风险高

<font color=blue>▲</font>： 表示特性基本可用，遗留少量问题

<font color=green>█</font>： 表示特性质量良好

### 4.1.3 基于社区10.3版本gcc提供ARM版本交叉编译工具链

特性测试主要包括交叉编译gcc 64、32位工具链整体测试，详细叙述测试覆盖情况，并通过问题分析对版本整体进行评估和总结。

| 特性名称 | 测试开始时间 | 测试结束时间 |
| ---- | ----------------------------------------- | :-------------------------: |
| 基于社区10.3版本gcc提供ARM版本交叉编译工具链 | 2022/3/14 | 2022/3/21 |

**环境信息**

| 硬件配置 |
| ---- |
| Intel(R) Xeon Platinum 8176M CPU@2.10GHz |
| Linux #166-Ubuntu SMP x86_64 GNU/Linux |

该版本主要验证了编译器一般使用场景——打开常用编译优化选项O1/O2/O3/Os/Ofast情况下的功能以及可靠性测试（并发、超规格用例测试），基本功能正常，deja等测试套相对开源社区gcc10.3源码编译版本无额外新增失败用例，质量良好。

**可靠性测试**

1.超规格用例测试编译运行无问题；

2.csmith/yarpgen 128线程并发生成用例并编译运行，均无问题，用例正常编译运行通过。

**随机测试**

| 类型 | 执行情况 |
| ---- | ----------------------------------------- |
| csmith普通版本（c/c++） | 100w+用例无问题 |
| csmith浮点版本 | 100w+用例无问题 |
| yarpgen普通版本（c/c++） | 100w+用例无问题 |

**遗留问题**

| 问题描述 | 问题级别 | 影响分析 | 规避措施 |
| ---- | ---- | ---- | ---- |
| 开启结构体拆分特性，arm32工具链编译运行用例Segmentation fault | 一般 | 自研特性问题，影响范围小 | arm32工具链使用时不开启-fipa-struct-reorg选项 |

## 4.2   兼容性测试结论

### 4.2.1   升级兼容性

openEuler embedded 22.03作为首个嵌入式版本不涉及升级兼容性测试

### 4.2.2   南向兼容性

南向兼容性仅对树莓派4B进行测试

下表列出版本集成验证中涉及的硬件整机信息：

| 硬件型号              | 硬件详细信息                                                                                          |
| --------------------- | ----------------------------------------------------------------------------------------------------- |
| 树莓派4B卡             | CPU:BCM2711(Cortex-A72 * 4) <br />内存：4GB/8GB <br />存储设备：SanDisk Ultra 64GB micro SD |        |


### 4.2.3   北向兼容性

openEuler embedded 22.03作为首个嵌入式版本不涉及兼容性测试

## 4.3   专项测试结论

### 安全测试

整体安全测试覆盖：

1、Linux系统安全配置管理类主要包括：服务管理、账号密码管理、文件及用户权限管理、内核参数配置管理、日志管理等进行全量测试，发现5个相关问题，所有问题均澄清或修改。

2、通过工具进行CVE漏洞/敏感信息/端口矩阵/编译选项扫描/交付件病毒扫描，发现CVE漏洞249个，其中222个为社区已有修复结论漏洞，23个为识别版本号与社区版本不一致导致，4个为新增漏洞，已提交社区issue，端口仅开启22端口，编译选项扫描完成符合社区要求，交付件无病毒。

3、针对安全加固指南中的加固项，进行全量测试，其中发现问题3个，问题均澄清和修复。

整体OS安全测试较充分，风险可控。

### 可靠性测试

| 测试类型     | 测试内容                                                                               | 测试结论                   |
| ------------ | -------------------------------------------------------------------------------------- | -------------------------- |
| 操作系统长稳 | 系统在各种压力背景下，随机执行LTP测试用例(包括通用用例、内存、系统调用、cgroup、文件系统等)；过程中关注系统重要进程/服务、日志的运行情况； | 操作系统稳定运行7\*24小时  |
| 断电重启测试 | 系统通过各种复位命令重启，包括系统调用复位重启、咬狗重启、panic重启，各执行100次 | 系统可以正常重启   |

### 资料测试

| **手册名称**       | **测试内容**                                                           | **测试结论** |
|------------------------------|------------------------------------------------------------------------|--------------------|
|《openEuler Embedded 快速上手》 | 获取镜像、运行镜像、基于SDK的应用开发 | 验收通过   |
|《openEuler Embedded 构建系统》 | 快速构建、Yocto介绍、新增软件包指导 | 验收通过   |
|《openEuler Embedded 关键特性》 | 混合部署、分布式软总线、树莓派系统 | 验收通过 |

# 5   问题单统计

openEuler 22.03 embedded版本共发现问题单73个，其中修复问题单71个，回归均通过。详细分布见下表:

| 测试阶段                    | 问题单数 |
| --------------------------- | -------- |
| openEuler embedded RC1 | 10  |
| openEuler embedded RC2 | 9   |
| openEuler embedded RC3 | 27  |
| openEuler embedded RC4 | 16  |
| openEuler embedded RC5 | 12  |
| openEuler embedded RC6 | 0   |

1、RC1 RC2为操作系统基础测试，主要聚焦于操作系统的基础功能，发现问题数较少，问题主要集中于工程构建及软件包编译问题；

2、从RC3开始进行新增特性和安全扫描类测试，问题发现数量较多，主要是安全配置、软件包功能等，经几轮测试迭代，问题数量呈收敛趋势

以下归纳了几类占比较多的问题分类分析：
## 5.1     问题单类型整理

| **问题大类**       | **具体问题**                                                           | **相关ISSUE个数** |
|--------------------|------------------------------------------------------------------------|--------------------|
| 软件包基本功能 | 依赖的内核模块或文件缺失 |  14 |
| 软件包基本功能 | Busybox的命令与实体命令实现不同 |  6  |
| 软件包基本功能 | 软件版本不一致 | 5  |
| 编译构建 | 用户在非容器化构建环境下，缺少命令导致的构建失败 |  11  |
| sdk脚本功能 | sysroot下的头文件缺失 | 5 |
| 安全加固配置 | 文件属性检查、开机启动服务检查等 | 7 |
| 分布式软总线 | server端的ipc初始化等 | 4 |

# 6   附件

## 遗留问题列表

| 序号 | 问题单号 | 问题简述                                                     | 问题级别 | 影响分析                                                     | 规避措施 |
| ---- | -------- | ------------------------------------------------------------ | -------- | ------------------------------------------------------------ | -------- |
| 1 | [I4ZQYE](https://gitee.com/openeuler/yocto-meta-openeuler/issues/I4ZQYE) | PAM返回码异常 | 次要 | 社区已知缺陷，不影响嵌入式版本实际功能 | |
| 2 | [I50DZN](https://gitee.com/openeuler/yocto-meta-openeuler/issues/I50DZN) | 尝试对已经销毁的线程进行pthread_kill测试，预期失败，结果成功 | 次要 | 不影响基本功能 | |