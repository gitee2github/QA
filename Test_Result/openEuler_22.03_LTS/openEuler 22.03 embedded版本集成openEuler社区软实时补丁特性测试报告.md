![openEuler ico](../../images/openEuler.png)

版权所有 © 2022  openEuler社区
 您对“本文档”的复制、使用、修改及分发受知识共享(Creative Commons)署名—相同方式共享4.0国际公共许可协议(以下简称“CC BY-SA 4.0”)的约束。为了方便用户理解，您可以通过访问https://creativecommons.org/licenses/by-sa/4.0/ 了解CC BY-SA 4.0的概要 (但不是替代)。CC BY-SA 4.0的完整协议内容您可以访问如下网址获取：https://creativecommons.org/licenses/by-sa/4.0/legalcode。

修订记录

| 日期 | 修订   版本 | 修改描述 | 作者 |
| ---- | ----------- | -------- | ---- |
| 2022-03-29 | 1.0 | 创建 | @saarloos |
| 2022-03-30 | 1.1 | 初稿 | @xukunkun2021 |

关键词：软实时 嵌入式

摘要：

本报告主要描述基于openEuler 22.03-LTS embedded版本进行的集成openEuler社区软实时补丁特性的测试过程，报告对测试情况进行说明，对特性的测试充分度进行评估和总结。
 
缩略语清单：

| 缩略语 | 英文全名 | 中文解释 |
| ------ | -------- | -------- |
| RT | real time | 实时 |

***

# 1     特性概述

联合sig-industrial-control，将linux实时补丁集成到openEuler，并支持通过yocto构建出具备软实时能力的嵌入式版本。

# 2     特性测试信息

本节描述被测对象的版本信息和测试的时间及测试轮次，以及硬件环境信息。

| 版本名称 | 测试起始时间 | 测试结束时间 |
| -------- | ------------ | ------------ |
| openEuler embedded 22.03 RC4 | 2022/3/25   | 2022/3/29   |

描述特性测试的硬件环境信息

| 硬件型号 | 硬件配置信息 | 备注 |
| -------- | ------------ | ---- |
| 树莓派4B卡 | CPU:BCM2711(Cortex-A72 * 4) <br />内存：4GB/8GB <br />存储设备：SanDisk Ultra 64GB micro SD |        |

# 3     测试结论概述

## 3.1   测试整体结论

<!-- 测试结论可以以一句话描述，如：XX特性，共计执行XX个用例，主要覆盖了XX测试和XX测试，通过经过fuzz和7*24的长稳测试，发现问题已解决，回归通过，无遗留风险，整体质量良好；或者表格的方式进行说明 -->

软实时特性，在标准镜像的基础上集成软实时补丁，通过yocto构建出openEuler嵌入式软实时镜像，在树莓派4B上部署，使用开源benchmark工具cyclictest进行软实时性能测试，测得空载状态下中断加调度的平均时延在8微秒；在待测系统上模拟出负载（CPU:90% 内存:50%），运行cyclictest大于24小时，统计出平均时延在14微秒，特性无遗留风险，整体质量良好；

| 测试活动 | 活动评价 |
| -------- | -------- |
| 软实时镜像构建 |   依据《openEuler Embedded容器构建指导》一键式构建出支持树莓派的RT镜像，并成功部署 |
| 软实时性能测试 - 空载 | 安装SDK，编译cyclictest并拷贝到单板，用例循环1000万次后，统计出平均时延为8微秒 |
| 软实时性能测试 - 压力 | 负载场景下时延测试，通过hackbench和LTP模拟出CPU和内存的压力，持续运行cyclictest大于24小时，统计出平均时延在14微秒 | |
*空载测试稳定较高测试时长对性能影响不大，负载测试环境变化大，需要拉长测试时间，以获得更准确的数据*

空载执行示例：

```
./cyclictest -p 90 -m -i 100 -n -h 100 -l 10000000
```

模拟负载脚本：

```
#!/bin/sh
# Most hardcore test (Ingo Molnar - http://lkml.org/lkml/2005/6/22/347)
# For Heavy CPU Ratio.
while true; do /bin/dd if=/dev/zero of=bigfile bs=10240 count=1024; done &
while true; do /usr/bin/killall hackbench; sleep 5; done &
while true; do /sbin/hackbench 20; sleep 1; done &
cd ltp-full-202201; while true; do ./runltp; done  &
```
## 3.2   约束说明
1. 标准镜像的基础上集成软实时补丁，通过yocto构建出RT镜像；
2. 在树莓派4B上部署；
3. 使用开源benchmark工具cyclictest进行性能测试；
4. 测试时系统为空载；

## 3.3   遗留问题分析

### 3.3.1 遗留问题影响以及规避措施

| 问题单号 | 问题描述 | 问题级别 | 问题影响和规避措施 | 当前状态 |
| -------- | -------- | -------- | ------------------ | -------- |
|   NA       |          |          |                    |          |

### 3.3.2 问题统计

|        | 问题总数 | 严重 | 主要 | 次要 | 不重要 |
| ------ | -------- | ---- | ---- | ---- | ------ |
| 数目   |     0    |      |      |      |        |
| 百分比 |     0    |      |      |      |        |


# 4     测试执行

## 4.1   测试执行统计数据

*本节内容根据测试用例及实际执行情况进行特性整体测试的统计，可根据第二章的测试轮次分开进行统计说明。*

| 版本名称 | 测试用例数 | 用例执行结果 | 发现问题单数 |
| -------- | ---------- | ------------ | ------------ |
| openEuler embedded 22.03 RC1 |       2     |    系统稳定运行，完成软实时性能测试     |       0       |

## 4.2   后续测试建议

后续测试需要关注点(可选)

# 5     附件

*此处可粘贴各类专项测试数据或报告*
