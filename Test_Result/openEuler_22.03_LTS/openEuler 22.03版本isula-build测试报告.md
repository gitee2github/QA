![avatar](../../images/openEuler.png)

版权所有 © 2020  openEuler社区
 您对“本文档”的复制、使用、修改及分发受知识共享(Creative Commons)署名—相同方式共享4.0国际公共许可协议(以下简称“CC BY-SA 4.0”)的约束。为了方便用户理解，您可以通过访问https://creativecommons.org/licenses/by-sa/4.0/ 了解CC BY-SA 4.0的概要 (但不是替代)。CC BY-SA 4.0的完整协议内容您可以访问如下网址获取：https://creativecommons.org/licenses/by-sa/4.0/legalcode。

修订记录

| 日期 | 修订版本 | 修改描述 | 作者 |
| ---- | ----------- | -------- | ---- |
| 2022/03/23 | v1.0 | 添加isula-build特性测试报告 | 邢为政 |

 关键词： isula-build 镜像构建

 

摘要：
isula-build 为openEuler开源的镜像构建工具，具有以下特点：完全兼容Dockerfile语法；可与iSulad、Docker快速集成；提供多种导出方式；支持IMA完整性度量架构；支持单阶段快速构建；支持静态构建；支持镜像分层保存加载。该测试报告将覆盖isula-build的所有功能特点，对isula-build镜像构建工具进行完整的功能性及可靠性测试。
 

缩略语清单：

| 缩略语 | 英文全名 | 中文解释 |
| ------ | -------- | -------- |
| IMA | Integrity Measurement Architecture | 完整性度量架构 |
| OCI | Open Container Initiative| 开放容器计划 |

# 1     特性概述

isula-build 有如下特点：
* 完全兼容 Dockerfile 语法： isula-build 完全兼容 Dockerfile 所有语法，支持多 Stage 构建，用户可以沿用 docker build 的使用习惯，
不需要任何学习成本。
* 与 iSulad、Docker 快速集成： isula-build 的镜像导出形式多样，可以直接导入到 iSulad 和 Docker 的本地 Storage。同时，还支持导出到
远端仓库和本地 tar 包，与周边组件的集成快速、方便。
* 镜像管理： isula-build 提供了本地镜像管理功能。除了 build 镜像之外，isula-build 还提供了 import/save/load/tag/rm 等镜像管理功能，这使得其镜像构建的来源更加丰富，导出形式更加多样。
* 快速：相比 docker build，isula-build 不会为每一条 Dockerfile 指令启动一个容器，只有 RUN 指令才会在容器中执
行，而且 Commit 的粒度是 Stage 而不是每一行指令。所以在通常的容器镜像构建场景，构建速度会有大幅提
高。
* 安全： 支持 IMA( Integrity Measurement Architecture，完整性度量架构)。这是内核中的一个子系统，能够基于自定义策略对通过 execve()、mmap() 和 open() 系统调用访问的文件进行度量。通过 isula-build 构建的镜
像能够保留 IMA 文件扩展属性，配合操作系统一起保证构建出来的容器镜像在运行侧可执行文件和动态库的
完整性度量。
* 静态构建： 静态构建，是指当构建镜像的输入，包括 Dockerfile 和命令行一致，并且指定构建时间戳，则在同一环境多次
构建结果得到的容器镜像 ID 相同，在某些需要记录 Dockerfile 对应容器镜像 ID，或者需要固定镜像 ID 的场景
下能发挥作用。


21.03 新增功能：
* 支持 pull 和 push 命令：通过命令 pull 拉取镜像到本地磁盘，通过 push 镜像推送至远端仓库。
* Manifest 列表管理：在不同的架构中使用相同的 Manifest 获取对应架构的镜像， Manifest 包含 create、
annotate、inspect 和 push 子命令。
* 支持 OCI 镜像格式：支持 OCI 格式镜像的构建、保存、导入导出、推送和拉取。
* 支持在特定用户组下运行：isula-build 的组件支持在特定用户组下运行，在用户组内的非特权用户可以操作
isula-build，提高安全系数。
* 支持导入和导出多个镜像：添加支持保存多个镜像到一个 tarball、或导入包含多个镜像的 tarball。

22.03-LTS 新增功能：
* 支持导入导出分层镜像，可以指定镜像的base/lib/app，进行分层导出，且如果多个app层依赖相同的base和lib，只会导出一份；同时支持导出分层镜像对应的导入功能。

# 2     特性测试信息

本节描述被测对象的版本信息和测试的时间及测试轮次，包括依赖的硬件。

| 版本名称                                | 测试起始时间        | 测试结束时间        |
| --------------------------------------- | ------------------- | ------------------- |
| openEuler-22.03-LTS:2022-02-17-07-16-10 | 2022-02-18 11:52:57 | 2022-02-21 15:32:25 |
| openEuler-22.03-LTS:2022-03-12-09-10-52 | 2022-02-21 15:32:25 | 2022-03-14 11:05:42 |
| openEuler-22.03-LTS:2022-03-22-06-12-47 | 2022-03-22 11:43:33 | 2022-03-22 12:39:13 |

# 3     测试结论概述

## 3.1   测试整体结论

isula-build镜像共构建特性，共计执行207个用例，主要覆盖了功能测试和可靠性测试，通过测试发现主要问题1个，问题已解决，回归通过，无遗留风险，整体质量良好

## 3.2   约束说明

无

## 3.3   遗留问题分析

### 3.3.1 遗留问题影响以及规避措施

| 问题单号 | 问题描述 | 问题级别 | 问题影响和规避措施 | 当前状态 |
|-------|--------|-------|-------|--------|
| https://gitee.com/openeuler/isula-build/issues/I4UTFN?from=project-issue | selinux开启环境下，isula-build 构建镜像失败 | 主要 | 在selinux开启的openEuler环境下，isula-build构建镜像失败；暂时屏蔽go-selinux依赖库的使用，使用openEuler默认selinux策略 | 闭环 |

### 3.3.2 问题统计

|        | 问题总数 | 严重 | 主要 | 次要 | 不重要 |
| ------ | -------- | ---- | ---- | ---- | ------ |
| 数目   | 1        | 0    | 1    | 0    | 0      |
| 百分比 | 100%     | 0    | 100% | 0    | 0      |

# 4     测试执行

## 4.1   测试执行统计数据

| 版本名称                                | 测试用例数 | 用例执行结果 | 发现问题单数 |
| --------------------------------------- | ---------- | ------------ | ------------ |
| openEuler-22.03-LTS:2022-02-17-07-16-10 | 207        | 166          | 1            |
| openEuler-22.03-LTS:2022-03-12-09-10-52 | 207        | 207          | 0            |
| openEuler-22.03-LTS:2022-03-22-06-12-47 | 207        | 207          | 0            |

# 5     附件

无
